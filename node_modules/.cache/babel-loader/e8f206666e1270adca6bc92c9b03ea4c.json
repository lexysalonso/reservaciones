{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport axios from \"axios\";\nimport storage from \"helpers/storage\";\nimport dayjs from \"dayjs\";\nimport jwt_decode from \"jwt-decode\";\nimport { useState, useContext } from 'react';\nimport UserContext from \"context/UserContext\";\nconst instance = axios.create();\nexport const useAxiosInstance = () => {\n  _s();\n\n  const {\n    setUSer,\n    setAccessToken\n  } = useContext(UserContext);\n  instance.interceptors.request.use(async resq => {\n    const token = storage.load(storage.Keys.auth) ? storage.load(storage.Keys.auth) : null;\n\n    if (token) {\n      let user = jwt_decode(token);\n      const isExpired = dayjs.unix(user.exp).diff(dayjs()) < 1;\n      if (!isExpired) return resq;\n      const token_refresh = storage.load(storage.Keys.refresh);\n      let options = {\n        url: \"/token/refresh/\",\n        method: \"POST\",\n        baseURL: process.env.REACT_APP_BACKEND,\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        data: {\n          refresh: token_refresh\n        }\n      };\n      let token_new = await axios(options);\n      let data = await token_new.data;\n      storage.save(storage.Keys.auth, data.access);\n      storage.save(storage.Keys.refresh, data.refresh);\n      setAccessToken(data.access);\n      setUSer(jwt_decode());\n      resq.headers['Authorization'] = `Bearer ${data.access}`;\n      console.log(\"ver new token\", data);\n    }\n\n    return resq;\n  }, err => {\n    console.log(\"Error\", err);\n    return Promise.reject(err);\n  });\n  return {\n    instance\n  };\n};\n\n_s(useAxiosInstance, \"5tbKqCYeUAYEVQhuIUbBto0AlSI=\");","map":{"version":3,"sources":["/media/lmdiaz/bd47588f-a8f9-4e55-b2d4-112c4f385fdf/Lexys/Programacion/proyecto/Reservaciones/Reservaciones-bootstrap/src/hooks/useAxiosInstance.js"],"names":["axios","storage","dayjs","jwt_decode","useState","useContext","UserContext","instance","create","useAxiosInstance","setUSer","setAccessToken","interceptors","request","use","resq","token","load","Keys","auth","user","isExpired","unix","exp","diff","token_refresh","refresh","options","url","method","baseURL","process","env","REACT_APP_BACKEND","headers","data","token_new","save","access","console","log","err","Promise","reject"],"mappings":";;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,OAAP,MAAoB,iBAApB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,OAAOC,UAAP,MAAuB,YAAvB;AACA,SAASC,QAAT,EAAoBC,UAApB,QAAqC,OAArC;AACA,OAAOC,WAAP,MAAwB,qBAAxB;AAEA,MAAMC,QAAQ,GAAGP,KAAK,CAACQ,MAAN,EAAjB;AAEA,OAAO,MAAMC,gBAAgB,GAAG,MAAK;AAAA;;AAChC,QAAM;AAACC,IAAAA,OAAD;AAASC,IAAAA;AAAT,MAA2BN,UAAU,CAACC,WAAD,CAA3C;AAEAC,EAAAA,QAAQ,CAACK,YAAT,CAAsBC,OAAtB,CAA8BC,GAA9B,CACA,MAAOC,IAAP,IAAgB;AACZ,UAAMC,KAAK,GAAGf,OAAO,CAACgB,IAAR,CAAahB,OAAO,CAACiB,IAAR,CAAaC,IAA1B,IAAkClB,OAAO,CAACgB,IAAR,CAAahB,OAAO,CAACiB,IAAR,CAAaC,IAA1B,CAAlC,GAAmE,IAAjF;;AACC,QAAIH,KAAJ,EAAU;AACP,UAAII,IAAI,GAAGjB,UAAU,CAACa,KAAD,CAArB;AACA,YAAMK,SAAS,GAAGnB,KAAK,CAACoB,IAAN,CAAWF,IAAI,CAACG,GAAhB,EAAqBC,IAArB,CAA0BtB,KAAK,EAA/B,IAAqC,CAAvD;AACA,UAAI,CAACmB,SAAL,EAAgB,OAAON,IAAP;AAEhB,YAAMU,aAAa,GAAGxB,OAAO,CAACgB,IAAR,CAAahB,OAAO,CAACiB,IAAR,CAAaQ,OAA1B,CAAtB;AAEA,UAAIC,OAAO,GAAG;AACZC,QAAAA,GAAG,EAAE,iBADO;AAEZC,QAAAA,MAAM,EAAE,MAFI;AAGZC,QAAAA,OAAO,EAAEC,OAAO,CAACC,GAAR,CAAYC,iBAHT;AAIZC,QAAAA,OAAO,EAAC;AACJ,0BAAe;AADX,SAJI;AAOZC,QAAAA,IAAI,EAAC;AACDT,UAAAA,OAAO,EAACD;AADP;AAPO,OAAd;AAWE,UAAIW,SAAS,GAAG,MAAMpC,KAAK,CAAC2B,OAAD,CAA3B;AACA,UAAIQ,IAAI,GAAG,MAAMC,SAAS,CAACD,IAA3B;AACAlC,MAAAA,OAAO,CAACoC,IAAR,CAAapC,OAAO,CAACiB,IAAR,CAAaC,IAA1B,EAA+BgB,IAAI,CAACG,MAApC;AACArC,MAAAA,OAAO,CAACoC,IAAR,CAAapC,OAAO,CAACiB,IAAR,CAAaQ,OAA1B,EAAkCS,IAAI,CAACT,OAAvC;AACAf,MAAAA,cAAc,CAACwB,IAAI,CAACG,MAAN,CAAd;AACA5B,MAAAA,OAAO,CAACP,UAAU,EAAX,CAAP;AACAY,MAAAA,IAAI,CAACmB,OAAL,CAAa,eAAb,IAAiC,UAASC,IAAI,CAACG,MAAO,EAAtD;AACCC,MAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ,EAA4BL,IAA5B;AAEN;;AACD,WAAOpB,IAAP;AACH,GAhCD,EAiCE0B,GAAD,IAAS;AACPF,IAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAoBC,GAApB;AACC,WAAQC,OAAO,CAACC,MAAR,CAAeF,GAAf,CAAR;AACF,GApCF;AAwCA,SAAO;AACHlC,IAAAA;AADG,GAAP;AAIJ,CA/CM;;GAAME,gB","sourcesContent":["import axios from \"axios\";\nimport storage from \"helpers/storage\";\nimport dayjs from \"dayjs\";\nimport jwt_decode from \"jwt-decode\";\nimport { useState , useContext} from 'react';\nimport UserContext from \"context/UserContext\";\n\nconst instance = axios.create();\n\nexport const useAxiosInstance = ()=> {\n     const {setUSer,setAccessToken} = useContext(UserContext)\n\n     instance.interceptors.request.use(\n     async (resq) => {\n         const token = storage.load(storage.Keys.auth) ? storage.load(storage.Keys.auth): null\n          if (token){\n             let user = jwt_decode(token)\n             const isExpired = dayjs.unix(user.exp).diff(dayjs()) < 1;\n             if (!isExpired) return resq;\n\n             const token_refresh = storage.load(storage.Keys.refresh)\n\n             let options = {\n               url: \"/token/refresh/\",\n               method: \"POST\",\n               baseURL: process.env.REACT_APP_BACKEND,\n               headers:{\n                   \"Content-Type\":\"application/json\"\n               },\n               data:{\n                   refresh:token_refresh\n               }\n             };\n               let token_new = await axios(options)\n               let data = await token_new.data\n               storage.save(storage.Keys.auth,data.access)\n               storage.save(storage.Keys.refresh,data.refresh)\n               setAccessToken(data.access);\n               setUSer(jwt_decode())\n               resq.headers['Authorization'] = `Bearer ${data.access}`\n                console.log(\"ver new token\",data)\n\n         }\n         return resq\n     },       \n      (err) => {\n        console.log(\"Error\",err);\n         return  Promise.reject(err);\n      }\n      \n    );\n    \n     return {\n         instance\n      } ;\n\n};\n\n"]},"metadata":{},"sourceType":"module"}